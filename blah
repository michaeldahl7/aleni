providers = ["node"]

[phases.install]
cmds = ["npm install -g corepack", "corepack enable", "corepack prepare pnpm@9.1.0 --activate", "pnpm install --include=dev"]

[phases.build]
cmds = [
  "pnpm exec drizzle-kit generate",
  "pnpm run build",
  "pnpm prune --omit=dev"
]

[start]
cmd = "sh -c 'pnpm exec drizzle-kit migrate && pnpm exec remix-serve ./build/server/index.js'"